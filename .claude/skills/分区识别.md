---
name: 分区识别
description: 智能识别和管理各种分区策略的专业工具
author: Claude Code
version: 1.0.0
requires_backend: false
---

# 分区识别系统

智能识别和管理数据库分区、文件分区、区域划分等场景。

## 分区类型

### 1. 数据库分区
```
[分区] 检测数据库分区
字段：region_code varchar(4)
表名：your_table
```

### 2. 地理分区
```
[分区] 识别地区代码
代码：[地区代码]
类型：[省/市/区]
```

### 3. 业务分区
```
[分区] 分析业务分区
数据：[业务数据]
维度：[时间/地区/类型]
```

## 常见分区模式

### 地区代码分区
```sql
-- 按地区代码分区
PARTITION BY LIST COLUMNS(region_code) (
    PARTITION p_north VALUES IN ('1100', '1200', '1300'),
    PARTITION p_south VALUES IN ('4400', '4500', '4600'),
    PARTITION p_east VALUES IN ('3100', '3200', '3300'),
    PARTITION p_west VALUES IN ('5100', '5200', '5300')
);
```

### 时间分区
```sql
-- 按月分区
PARTITION BY RANGE (TO_MONTH(create_time)) (
    PARTITION p202401 VALUES LESS THAN ('2024-02-01'),
    PARTITION p202402 VALUES LESS THAN ('2024-03-01'),
    PARTITION p202403 VALUES LESS THAN ('2024-04-01')
);
```

### 哈希分区
```sql
-- 按用户ID哈希分区
PARTITION BY HASH(user_id) PARTITIONS 8;
```

## 使用示例

### 示例1：分析地区代码
```
[分区] 分析地区代码分布
数据：
- 1100: 北京
- 3100: 上海
- 4400: 广东
- 3200: 江苏
- 3300: 浙江

系统输出：
建议按经济区域分区：
华北：1100, 1200, 1300
华东：3100, 3200, 3300, 3400
华南：4400, 4500, 4600
```

### 示例2：检测数据库分区策略
```
[分区] 检测表分区需求
表结构：
- region_code varchar(4)
- create_time datetime
- user_id bigint
- amount decimal(10,2)

系统建议：
1. 地区代码分区（4个区：华北/华东/华南/西部）
2. 时间分区（按月，保留12个月）
3. 复合分区：先地区后时间
```

### 示例3：文件系统分区
```
[分区] 分析文件目录
路径：/data/logs/2024/12/15/

系统识别：
时间分区：年/月/日
建议策略：
- 按月归档
- 压缩30天前的数据
- 保留1年内的数据
```

## 分区策略建议

### 选择分区键的原则
1. **高查询频率**：经常作为WHERE条件的字段
2. **数据均匀**：避免分区倾斜
3. **业务相关**：符合业务逻辑
4. **维护方便**：便于数据迁移和清理

### 地区代码分区建议
```sql
-- 中国地区代码分区策略
华北地区：'11'北京, '12'天津, '13'河北, '14'山西, '15'内蒙古
华东地区：'31'上海, '32'江苏, '33'浙江, '34'安徽, '35'福建, '36'江西, '37'山东
华南地区：'41'河南, '42'湖北, '43'湖南, '44'广东, '45'广西, '46'海南
西部地区：'50'重庆, '51'四川, '52'贵州, '53'云南, '54'西藏, '61'陕西, '62'甘肃, '63'青海, '64'宁夏, '65'新疆
东北地区：'21'辽宁, '22'吉林, '23'黑龙江
```

## 实用命令

### 检测现有分区
```bash
[分区] 查看分区信息
表名：your_table
```

### 评估分区效果
```bash
[分区] 评估分区性能
查询SQL：[SQL语句]
分区策略：[当前策略]
```

### 优化分区建议
```bash
[分区] 优化建议
表大小：[GB]
查询模式：[描述]
当前分区：[现状]
```

## 输出格式

```markdown
# 分区分析报告

## 当前分区状况
- 分区类型：[类型]
- 分区数量：[数量]
- 数据分布：[描述]

## 问题诊断
1. [问题1]
2. [问题2]

## 优化建议
1. 建议方案：[具体方案]
2. 预期收益：[性能提升]
3. 实施步骤：[步骤]

## SQL示例
```sql
[优化后的分区SQL]
```

## 注意事项
- [提醒1]
- [提醒2]
```

## 最佳实践

1. **分区数量控制**：不超过20个分区
2. **数据均衡**：每个分区数据量相近
3. **查询优化**：分区键要包含在查询条件中
4. **定期维护**：定期检查分区状态
5. **监控告警**：设置分区大小告警

## 常见问题

### Q: 分区后查询变慢？
A: 检查查询条件是否包含分区键

### Q: 某个分区过大？
A: 考虑子分区或重新划分

### Q: 如何合并分区？
A: 使用 ALTER TABLE REORGANIZE PARTITION

开始使用：`[分区] 你的分区需求`